- name: Odroid-GitOps root setup
  hosts: flimsy-castle-root
  gather_facts: true

  environment:
    PATH: "/home/linuxbrew/.linuxbrew/bin:/home/linuxbrew/.linuxbrew/sbin:{{ ansible_env.PATH }}"

  pre_tasks:
    - name: Ensure base packages required by roles are present
      ansible.builtin.package:
        name: "{{ item }}"
        state: present
      loop:
        - python3
        - rsync
      tags: prerequisites

  roles:
    - role: setup_install_brew
      tags:
        - setup_install_brew
        - setup

    - role: setup_install_flux_cli
      tags:
        - setup_install_flux_cli
        - setup

    - role: setup_install_helm
      tags:
        - setup_install_helm
        - setup

    - role: setup_install_ansible
      tags:
        - setup_install_ansible
        - setup

    - role: mankis_room_create_user
      tags:
        - mankis_room_create_user
        - mankis_room

    - role: mankis_room_setup_zsh
      tags:
        - mankis_room_setup_zsh
        - mankis_room
